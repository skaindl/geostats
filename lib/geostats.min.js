!function(t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(t):geostats=t()}(function(){var t=function(t){return t},s=function(t){return!isNaN(parseFloat(t))&&isFinite(t)};Array.prototype.indexOf||(Array.prototype.indexOf=function(t,i){if(void 0===this||null===this)throw new TypeError('"this" is null or not defined');var s=this.length>>>0;for(i=+i||0,1/0===Math.abs(i)&&(i=0),0>i&&(i+=s,0>i&&(i=0));s>i;i++)if(this[i]===t)return i;return-1});var e=function(e){this.objectId="",this.separator=" - ",this.legendSeparator=this.separator,this.method="",this.precision=0,this.precisionflag="auto",this.roundlength=2,this.is_uniqueValues=!1,this.debug=!1,this.bounds=Array(),this.ranges=Array(),this.inner_ranges=null,this.colors=Array(),this.counter=Array(),this.stat_sorted=null,this.stat_mean=null,this.stat_median=null,this.stat_sum=null,this.stat_max=null,this.stat_min=null,this.stat_pop=null,this.stat_variance=null,this.stat_stddev=null,this.stat_cov=null,this.log=function(t){1==this.debug&&console.log(this.objectID+"(object id) :: "+t)},this.setBounds=function(t){this.log("Setting bounds ("+t.length+") : "+t.join()),this.bounds=Array(),this.bounds=t},this.setSerie=function(t){this.log("Setting serie ("+t.length+") : "+t.join()),this.serie=Array(),this.serie=t,this.setPrecision()},this.setColors=function(t){this.log("Setting color ramp ("+t.length+") : "+t.join()),this.colors=t},this.doCount=function(){if(!this._nodata()){var t=this.sorted();for(this.counter=new Array,i=0;i<this.bounds.length-1;i++)this.counter[i]=0;for(j=0;j<t.length;j++){var s=this.getClass(t[j]);this.counter[s]++}}},this.setPrecision=function(t){if("undefined"!=typeof t&&(this.precisionflag="manual",this.precision=t),"auto"==this.precisionflag)for(var i=0;i<this.serie.length;i++){if(isNaN(this.serie[i]+"")||-1==(this.serie[i]+"").toString().indexOf("."))var s=0;else var s=(this.serie[i]+"").split(".")[1].length;s>this.precision&&(this.precision=s)}this.log("Calling setPrecision(). Mode : "+this.precisionflag+" - Decimals : "+this.precision),this.serie=this.decimalFormat(this.serie)},this.decimalFormat=function(t){for(var i=new Array,e=0;e<t.length;e++)i[e]=s(t[e])?parseFloat(t[e].toFixed(this.precision)):t[e];return i},this.setRanges=function(){for(this.ranges=Array(),i=0;i<this.bounds.length-1;i++)this.ranges[i]=this.bounds[i]+this.separator+this.bounds[i+1]},this.min=function(){return this._nodata()?void 0:(this.stat_min=Math.min.apply(null,this.serie),this.stat_min)},this.max=function(){return this.stat_max=Math.max.apply(null,this.serie),this.stat_max},this.sum=function(){if(!this._nodata()){if(null==this.stat_sum)for(this.stat_sum=0,i=0;i<this.pop();i++)this.stat_sum+=parseFloat(this.serie[i]);return this.stat_sum}},this.pop=function(){return this._nodata()?void 0:(null==this.stat_pop&&(this.stat_pop=this.serie.length),this.stat_pop)},this.mean=function(){return this._nodata()?void 0:(null==this.stat_mean&&(this.stat_mean=parseFloat(this.sum()/this.pop())),this.stat_mean)},this.median=function(){if(!this._nodata()){if(null==this.stat_median){this.stat_median=0;var t=this.sorted();this.stat_median=t.length%2?parseFloat(t[Math.ceil(t.length/2)-1]):(parseFloat(t[t.length/2-1])+parseFloat(t[t.length/2]))/2}return this.stat_median}},this.variance=function(){if(round="undefined"==typeof round?!0:!1,!this._nodata()){if(null==this.stat_variance){for(var t=0,i=0;i<this.pop();i++)t+=Math.pow(this.serie[i]-this.mean(),2);this.stat_variance=t/this.pop(),1==round&&(this.stat_variance=Math.round(this.stat_variance*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength))}return this.stat_variance}},this.stddev=function(t){return t="undefined"==typeof t?!0:!1,this._nodata()?void 0:(null==this.stat_stddev&&(this.stat_stddev=Math.sqrt(this.variance()),1==t&&(this.stat_stddev=Math.round(this.stat_stddev*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength))),this.stat_stddev)},this.cov=function(t){return t="undefined"==typeof t?!0:!1,this._nodata()?void 0:(null==this.stat_cov&&(this.stat_cov=this.stddev()/this.mean(),1==t&&(this.stat_cov=Math.round(this.stat_cov*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength))),this.stat_cov)},this._nodata=function(){return 0==this.serie.length?1:0},this._hasNegativeValue=function(){for(i=0;i<this.serie.length;i++)if(this.serie[i]<0)return!0;return!1},this._hasZeroValue=function(){for(i=0;i<this.serie.length;i++)if(0===parseFloat(this.serie[i]))return!0;return!1},this.sorted=function(){return null==this.stat_sorted&&(this.stat_sorted=this.serie.sort(0==this.is_uniqueValues?function(t,i){return t-i}:function(t,i){var s=t.toString().toLowerCase(),e=i.toString().toLowerCase();return e>s?-1:s>e?1:0})),this.stat_sorted},this.info=function(){if(!this._nodata()){var i="";return i+=t("Population")+" : "+this.pop()+" - ["+t("Min")+" : "+this.min()+" | "+t("Max")+" : "+this.max()+"]\n",i+=t("Mean")+" : "+this.mean()+" - "+t("Median")+" : "+this.median()+"\n",i+=t("Variance")+" : "+this.variance()+" - "+t("Standard deviation")+" : "+this.stddev()+" - "+t("Coefficient of variation")+" : "+this.cov()+"\n"}},this.setClassManually=function(i){return this._nodata()?void 0:i[0]!==this.min()||i[i.length-1]!==this.max()?void this.log(t("Given bounds may not be correct! please check your input.\nMin value : "+this.min()+" / Max value : "+this.max())):(this.setBounds(i),this.setRanges(),this.method=t("manual classification")+" ("+(i.length-1)+" "+t("classes")+")",this.bounds)},this.getClassEqInterval=function(s,e,n){if(!this._nodata()){var a="undefined"==typeof e?this.min():e,r="undefined"==typeof n?this.max():n,o=Array(),h=a,u=(r-a)/s;for(i=0;i<=s;i++)o[i]=h,h+=u;return o[s]=r,this.setBounds(o),this.setRanges(),this.method=t("eq. intervals")+" ("+s+" "+t("classes")+")",this.bounds}},this.getQuantiles=function(t){for(var i=this.sorted(),s=[],e=this.pop()/t,n=1;t>n;n++){var a=Math.round(n*e+.49);s.push(i[a-1])}return s},this.getClassQuantile=function(i){if(!this._nodata()){var s=this.sorted(),e=this.getQuantiles(i);return e.unshift(s[0]),e[s.length-1]!==s[s.length-1]&&e.push(s[s.length-1]),this.setBounds(e),this.setRanges(),this.method=t("quantile")+" ("+i+" "+t("classes")+")",this.bounds}},this.getClassStdDeviation=function(s){if(!this._nodata()){var e=(this.max(),this.min(),Array());if(s%2==1){var n=Math.floor(s/2),a=n+1;for(e[n]=this.mean()-this.stddev()/2,e[a]=this.mean()+this.stddev()/2,i=n-1;i>0;i--){var r=e[i+1]-this.stddev();e[i]=r}for(i=a+1;i<s;i++){var r=e[i-1]+this.stddev();e[i]=r}}else{var o=s/2;for(e[o]=this.mean(),i=o-1;i>0;i--){var r=e[i+1]-this.stddev();e[i]=r}for(i=o+1;i<s;i++){var r=e[i-1]+this.stddev();e[i]=r}}return e[0]=this.min(),e[s]=this.max(),this.setBounds(e),this.setRanges(),this.method=t("std deviation")+" ("+s+" "+t("classes")+")",this.bounds}},this.getClassGeometricProgression=function(s){if(!this._nodata()){if(this._hasNegativeValue()||this._hasZeroValue())return void this.log(t("geometric progression can't be applied with a serie containing negative or zero values."));var e=Array(),n=this.min(),a=this.max(),r=Math.log(a)/Math.LN10,o=Math.log(n)/Math.LN10,h=(r-o)/s;for(i=0;i<s;i++)e[i]=0==i?o:e[i-1]+h;return e=e.map(function(t){return Math.pow(10,t)}),e.push(this.max()),this.setBounds(e),this.setRanges(),this.method=t("geometric progression")+" ("+s+" "+t("classes")+")",this.bounds}},this.getClassArithmeticProgression=function(s){if(!this._nodata()){var e=0;for(i=1;i<=s;i++)e+=i;var n=Array(),a=this.min(),r=this.max(),o=(r-a)/e;for(i=0;i<=s;i++)n[i]=0==i?a:n[i-1]+i*o;return this.setBounds(n),this.setRanges(),this.method=t("arithmetic progression")+" ("+s+" "+t("classes")+")",this.bounds}},this.getClassJenks=function(i){if(!this._nodata()){dataList=this.sorted();for(var s=[],e=0,n=dataList.length+1;n>e;e++){for(var a=[],r=0,o=i+1;o>r;r++)a.push(0);s.push(a)}for(var h=[],u=0,l=dataList.length+1;l>u;u++){for(var d=[],g=0,f=i+1;f>g;g++)d.push(0);h.push(d)}for(var c=1,p=i+1;p>c;c++){s[0][c]=1,h[0][c]=0;for(var v=1,m=dataList.length+1;m>v;v++)h[v][c]=1/0;var _=0}for(var b=2,y=dataList.length+1;y>b;b++){for(var M=0,x=0,F=0,C=1,A=b+1;A>C;C++){var w=b-C+1,L=parseFloat(dataList[w-1]);x+=L*L,M+=L,F+=1,_=x-M*M/F;var j=w-1;if(0!=j)for(var q=2,S=i+1;S>q;q++)h[b][q]>=_+h[j][q-1]&&(s[b][q]=w,h[b][q]=_+h[j][q-1])}s[b][1]=1,h[b][1]=_}var V=dataList.length,P=[];for(u=0;i>=u;u++)P.push(0);P[i]=parseFloat(dataList[dataList.length-1]),P[0]=parseFloat(dataList[0]);for(var R=i;R>=2;){var I=parseInt(s[V][R]-2);P[R-1]=dataList[I],V=parseInt(s[V][R]-1),R-=1}return P[0]==P[1]&&0<P[1]&&(P[0]=0),this.setBounds(P),this.setRanges(),this.method=t("Jenks")+" ("+i+" "+t("classes")+")",this.bounds}},this.getClassUniqueValues=function(){if(!this._nodata()){this.is_uniqueValues=!0;var s=this.sorted(),e=Array();for(i=0;i<this.pop();i++)-1===e.indexOf(s[i])&&e.push(s[i]);return this.bounds=e,this.method=t("unique values"),e}},this.getClass=function(s){for(i=0;i<this.bounds.length;i++)if(1==this.is_uniqueValues){if(s==this.bounds[i])return i}else if(parseFloat(s)<=this.bounds[i+1])return i;return t("Unable to get value's class.")},this.getRanges=function(){return this.ranges},this.getRangeNum=function(t){var i,s;for(s=0;s<this.ranges.length;s++)if(i=this.ranges[s].split(/ - /),t<=parseFloat(i[1]))return s},this.getInnerRanges=function(){if(null!=this.inner_ranges)return this.inner_ranges;var t=new Array,s=this.sorted(),e=1;for(i=0;i<s.length;i++){if(0==i)var n=s[i];if(parseFloat(s[i])>parseFloat(this.bounds[e])){t[e-1]=""+n+this.separator+s[i-1];var n=s[i];e++}if(e==this.bounds.length-1)return t[e-1]=""+n+this.separator+s[s.length-1],this.inner_ranges=t,this.inner_ranges}},this.getSortedlist=function(){return this.sorted().join(", ")},this.getHtmlLegend=function(i,s,e,n,a){var r,o,h,u,l,d="";if(this.doCount(),o=null!=i?i:this.colors,h=null!=s?s:"Legend",u=null!=e?!0:!1,l=null!=n?n:function(t){return t},null==a&&(a="default"),"discontinuous"==a&&(this.getInnerRanges(),-1!==this.counter.indexOf(0)))return void this.log(t("Geostats cannot apply 'discontinuous' mode to the getHtmlLegend() method because some classes are not populated.\nPlease switch to 'default' or 'distinct' modes. Exit!"));if(o.length<this.ranges.length)return void this.log(t("The number of colors should fit the number of ranges. Exit!"));var g='<div class="geostats-legend"><div class="geostats-legend-title">'+t(h)+"</div>";if(0==this.is_uniqueValues)for(r=this.ranges.length-1;r>=0;r--){u===!0&&(d=' <span class="geostats-legend-counter">('+this.counter[r]+")</span>");var f=this.ranges[r].split(this.separator),c=parseFloat(f[0]).toFixed(this.precision),p=parseFloat(f[1]).toFixed(this.precision);if("distinct"==a&&0!=r&&(c=parseFloat(c)+1/Math.pow(10,this.precision),c=parseFloat(c).toFixed(this.precision)),"discontinuous"==a)var f=this.inner_ranges[r].split(this.separator),c=parseFloat(f[0]).toFixed(this.precision),p=parseFloat(f[1]).toFixed(this.precision);var v=l(c)+this.legendSeparator+l(p);g+='<div><div class="geostats-legend-block" style="background-color:'+o[r]+'"></div> '+v+d+"</div>"}else for(r=this.bounds.length-1;r>=0;r--){u===!0&&(d=' <span class="geostats-legend-counter">('+this.counter[r]+")</span>");var v=l(this.bounds[r]);g+='<div><div class="geostats-legend-block" style="background-color:'+o[r]+'"></div> '+v+d+"</div>"}return g+="</div>"},this.objectID=(new Date).getUTCMilliseconds(),this.log("Creating new geostats object"),"undefined"!=typeof e&&e.length>0?(this.serie=e,this.setPrecision(),this.log("Setting serie ("+e.length+") : "+e.join())):this.serie=Array(),this.getJenks=this.getClassJenks,this.getGeometricProgression=this.getClassGeometricProgression,this.getEqInterval=this.getClassEqInterval,this.getQuantile=this.getClassQuantile,this.getStdDeviation=this.getClassStdDeviation,this.getUniqueValues=this.getClassUniqueValues,this.getArithmeticProgression=this.getClassArithmeticProgression};return e});